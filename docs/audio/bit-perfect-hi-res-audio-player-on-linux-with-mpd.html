<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Bit-Perfect Hi-Res Audio Player on Linux with MPD | Maxie’s Notes</title>
    <meta name="description" content="Maksim Shkrebtan’s personal documentation website">
    
    
    <link rel="preload" href="/assets/css/0.styles.3d7f8a6f.css" as="style"><link rel="preload" href="/assets/js/app.5a925217.js" as="script"><link rel="preload" href="/assets/js/2.e9e99a32.js" as="script"><link rel="preload" href="/assets/js/5.9c8db5fa.js" as="script"><link rel="prefetch" href="/assets/js/10.97b2bb00.js"><link rel="prefetch" href="/assets/js/11.6c64520e.js"><link rel="prefetch" href="/assets/js/12.60a48ea1.js"><link rel="prefetch" href="/assets/js/13.e2118e19.js"><link rel="prefetch" href="/assets/js/14.4b7f4a7d.js"><link rel="prefetch" href="/assets/js/15.a0668821.js"><link rel="prefetch" href="/assets/js/16.1845d204.js"><link rel="prefetch" href="/assets/js/17.147c14fe.js"><link rel="prefetch" href="/assets/js/18.1c686410.js"><link rel="prefetch" href="/assets/js/19.87cae817.js"><link rel="prefetch" href="/assets/js/20.2bfcb697.js"><link rel="prefetch" href="/assets/js/21.8f8c3e91.js"><link rel="prefetch" href="/assets/js/22.2d679b08.js"><link rel="prefetch" href="/assets/js/23.420c0fc6.js"><link rel="prefetch" href="/assets/js/24.2c30ad51.js"><link rel="prefetch" href="/assets/js/25.3814ecf9.js"><link rel="prefetch" href="/assets/js/26.ef72e736.js"><link rel="prefetch" href="/assets/js/3.ea1bb145.js"><link rel="prefetch" href="/assets/js/4.ddcd1e4e.js"><link rel="prefetch" href="/assets/js/6.974bdc44.js"><link rel="prefetch" href="/assets/js/7.2cd489f5.js"><link rel="prefetch" href="/assets/js/8.c8a07e8f.js"><link rel="prefetch" href="/assets/js/9.342aeeb0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3d7f8a6f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Maxie’s Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/ru/" class="nav-link">Русский</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/ru/" class="nav-link">Русский</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Audio</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html" class="active sidebar-link">Bit-Perfect Hi-Res Audio Player on Linux with MPD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html#problem" class="sidebar-link">Problem</a></li><li class="sidebar-sub-header"><a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html#solution" class="sidebar-link">Solution</a></li><li class="sidebar-sub-header"><a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html#prerequisites" class="sidebar-link">Prerequisites</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html#computer" class="sidebar-link">Computer</a></li><li class="sidebar-sub-header"><a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html#linux-distro" class="sidebar-link">Linux Distro</a></li><li class="sidebar-sub-header"><a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html#usb-dac" class="sidebar-link">USB DAC</a></li></ul></li><li class="sidebar-sub-header"><a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html#setup" class="sidebar-link">Setup</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html#permanent-index-value-for-the-sound-card-recommended" class="sidebar-link">Permanent index value for the sound card (Recommended)</a></li><li class="sidebar-sub-header"><a href="/audio/bit-perfect-hi-res-audio-player-on-linux-with-mpd.html#mpd-configuration" class="sidebar-link">MPD Configuration</a></li></ul></li></ul></li><li><a href="/audio/edit-encoded-audio-with-ffmpeg-and-audacity.html" class="sidebar-link">Edit Encoded Audio with FFmpeg and Audacity</a></li><li><a href="/audio/downsample-audio-with-sox.html" class="sidebar-link">Downsample Audio with SoX</a></li><li><a href="/audio/dsd-to-pcm-conversion-with-ffmpeg.html" class="sidebar-link">DSD to PCM Conversion with FFmpeg</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kindle</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Privacy</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Proxy &amp; VPN</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>macOS</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="bit-perfect-hi-res-audio-player-on-linux-with-mpd"><a href="#bit-perfect-hi-res-audio-player-on-linux-with-mpd" aria-hidden="true" class="header-anchor">#</a> Bit-Perfect Hi-Res Audio Player on Linux with MPD</h1> <p><em>Build a custom audiophile quality digital audio player with a Linux PC,
MPD and a USB DAC.</em></p> <p><img src="/assets/img/maxies-stereo-system.1ab8114a.png" alt="Maxie's stereo system"></p> <h2 id="problem"><a href="#problem" aria-hidden="true" class="header-anchor">#</a> Problem</h2> <p>If you have a growing digital collection of music titles, you might be
considering buying a network audio player to provide audiophile quality
playback. However, being an excellent all-in-one and easy to set up devices,
network audio players still have limitations:</p> <ul><li><p>they might have a built-in DAC, which you cannot swap;</p></li> <li><p>they might not support some storage devices, such as external HDD;</p></li> <li><p>they might not support some audio formats, take DSD128 for example;</p></li> <li><p>they are usually controlled with a mobile app, which might be inconvenient or
buggy;</p></li> <li><p>they are rather expensive!</p></li></ul> <h2 id="solution"><a href="#solution" aria-hidden="true" class="header-anchor">#</a> Solution</h2> <p>An alternative to a ready-made network audio player would be a PC with proper
software and a USB DAC.</p> <p>When it comes to the software, my personal recommendation would be to go with
<a href="https://www.musicpd.org/" target="_blank" rel="noopener noreferrer">Music Player Daemon (MPD)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. It is an extremely
flexible, powerful, server-side application for playing music.</p> <p>MPD features:</p> <ul><li><p>support of
<a href="https://en.wikipedia.org/wiki/Advanced_Linux_Sound_Architecture" target="_blank" rel="noopener noreferrer">ALSA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
output and hence bit-perfect playback;</p></li> <li><p>a great variety of audio formats supported (plays virtually anything);</p></li> <li><p>a wide selection of clients available, from console to mobile apps, for
remote playback control;</p></li> <li><p>you can play music from any storage device, be it an external HDD, a USB
drive, a memory card, an optical disk or a NAS volume.</p></li></ul> <p>And it is free! Just as Linux.</p> <h2 id="prerequisites"><a href="#prerequisites" aria-hidden="true" class="header-anchor">#</a> Prerequisites</h2> <p><img src="/assets/img/maxies-stereo-system-electronics.a4914022.png" alt="Maxie's electronics"></p> <h3 id="computer"><a href="#computer" aria-hidden="true" class="header-anchor">#</a> Computer</h3> <p>MPD runs on Windows, macOS, BSD, Linux and other UNIX-like operating systems.
But if you want to achieve <em>bit-perfect</em> playback, the best and (probably) the
only option is to run it on Linux.</p> <p>A part of Linux is ALSA (Advanced Linux Sound Architecture) — a set of
built-in Linux kernel modules that provide an interface (API) for sound card
device drivers. ALSA handles automatic configuration of sound-card hardware and
multiple sound devices.</p> <p>With ALSA you can configure a direct sound output without any processing
(e. g. resampling) in between the audio player and the sound card. ALSA is
supported by all Linux audio players including MPD.</p> <p>That said, you will need any computer that can run Linux. Even a single-board
ARM-powered computer, such as Raspberry Pi, will do.</p> <p>As for me, I needed something more powerful than a Raspberry Pi, that's why I
bought an Intel NUC mini-PC unit with an x86-64 CPU, and installed RAM and SSD
in it — payed less than $250 for everything. My NUC is running Debain Linux. I
installed strongSwan VPN server and an NFS server on it to make my media
library available throughout the network, and PLEX server for video streaming.
And of course, I installed MPD and configured it to output audio through ALSA
to my Arcam irDAC-II connected via USB.</p> <h3 id="linux-distro"><a href="#linux-distro" aria-hidden="true" class="header-anchor">#</a> Linux Distro</h3> <p>So, you will need to install a Linux distribusion on your computer, if you
are not using it already.</p> <p>Linux by itself is just a kernel. If you want a complete operating system, you
need to choose and install a Linux distribusion which includes the Linux
kernel, package manager and a collection of software. My personal choice is
<a href="https://www.debian.org/" target="_blank" rel="noopener noreferrer">Debian<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. If you are new to Linux, I would recommend
you to start with <a href="https://ubuntu.com/" target="_blank" rel="noopener noreferrer">Ubuntu<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>In case you are going to run MPD on a server, consider installing a server
variant of the distribusion of your choice. Although my Intel NUC has an HDMI
output for connecting a display, I do not use it as a desktop computer.
Instead, I interact with it through remote command-line interface (via SSH) and
I control MPD playback on my iPhone. I do not need a window system, a window
manager, or a desktop environment, and server distribusions do not include
these.</p> <h3 id="usb-dac"><a href="#usb-dac" aria-hidden="true" class="header-anchor">#</a> USB DAC</h3> <p>If you want to get the best sonic quality, you will need an good external
Digital-to-analog converter (DAC). There are plenty of DACs available and you
have to choose one by yourself. The one I use is <a href="https://www.arcam.co.uk/products,rSeries,USB-DAC,irdacii.htm" target="_blank" rel="noopener noreferrer">Arcam
irDAC-II<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Back
in the day, I bought it for a very good price. If you want to get a very good
value for money, consider a DAC from <a href="https://emotiva.com/" target="_blank" rel="noopener noreferrer">Emotiva<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> or
<a href="https://www.schiit.com/" target="_blank" rel="noopener noreferrer">Schiit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="setup"><a href="#setup" aria-hidden="true" class="header-anchor">#</a> Setup</h2> <p>So, you have Linux running on your computer, a DAC attached to it via USB and
your music library mounted in the filesystem. Time to set up MPD!</p> <p>MPD is a server application (hence the name — Music Player <strong>Daemon</strong>), and it
does not have a GUI to interact with. Instead, you need to edit its
configuration file located at <code>/etc/mpd.conf/</code>. It's not the only file you need
to edit, so the best way to go is to open a terminal emulator and use a
terminal text editor, such as Vim, Emacs or Nano.</p> <div class="warning custom-block"><p>This guide assumes that you are using Ubuntu or any other Debian-based Linux
distro and use Vim as text editor. If you are using a different editor (say,
Emacs) just substitute <code>vim</code> for it in the command line instructions cited
in this guide.</p> <p>If you do not know how to exit Vim, press <code>:q!</code> to quit without saving changes.</p> <p>If you want to use a simple and friendly editor, use Nano (<code>nano</code>).</p></div> <div class="tip custom-block"><p>If you want to learn Vim and find out why so many people love it, run
<code>vimtutor</code> and have a tutorial on how to use Vim.</p></div> <div class="tip custom-block"><p>If you do not feel comfortable with a command-line interface at all, you can
run a file browser as the superuser and edit files in graphical text editors.
To do this on Ubuntu 18.04, for example, open a terminal emulator and run:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo nautilus
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <h3 id="permanent-index-value-for-the-sound-card-recommended"><a href="#permanent-index-value-for-the-sound-card-recommended" aria-hidden="true" class="header-anchor">#</a> Permanent index value for the sound card (Recommended)</h3> <div class="tip custom-block"><p class="custom-block-title">Optional step</p> <p>This step is optional and you might skip it if you have
only one external audio device that you connect to your computer. However, I do
recommend to set up permanent index values for your sound devices if you have
many of them.</p></div> <p>Every time you connect your DAC to your computer, the <em>Generic USB Audio
Driver</em> (the <code>snd-usb-audio</code> kernel module) assigns an index value to the DAC's
sound card. You will need to specify this value in the output configration of
MPD. When you have multiple audio devices and you connect and disconnect them
often, the <code>snd-usb-audio</code> module might assign different index values for the
same device each time you reconnect it. To make sure that an MPD output (and
you can configure multiple outputs!) is always using the same device, you might
want to assign permanent index values to each device.</p> <p>To assign permanent index values, you need to set them in the <code>snd-usb-audio</code>
module options.</p> <h4 id="list-the-soundcards"><a href="#list-the-soundcards" aria-hidden="true" class="header-anchor">#</a> List the soundcards</h4> <p>First, find out which index values are already used for other sound devices.
Disconnect your DAC(s) and list all the soundcards:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>aplay -l
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="output"><p class="title">Example output:</p><div class="language- line-numbers-mode"><pre class="language-text"><code>**** List of PLAYBACK Hardware Devices ****
card 0: PCH [HDA Intel PCH], device 0: ALC283 Analog [ALC283 Analog]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 0: PCH [HDA Intel PCH], device 1: ALC283 Digital [ALC283 Digital]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 0: PCH [HDA Intel PCH], device 3: HDMI 0 [HDMI 0]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 0: PCH [HDA Intel PCH], device 7: HDMI 1 [HDMI 1]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 0: PCH [HDA Intel PCH], device 8: HDMI 2 [HDMI 2]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></div><p>In the example output above you see that index <code>0</code> is assigned to the <code>HDA Intel PCH</code> soundcard. This is a soundcard integrated into the motherboard.</p> <p>When you connect your DAC, its sound card gets a free index. Let's see what
happens when I connect my Arcam irDAC-II:</p> <div class="output"><p class="title">A USB DAC connected</p><div class="language- line-numbers-mode"><pre class="language-text"><code>**** List of PLAYBACK Hardware Devices ****
card 0: PCH [HDA Intel PCH], device 0: ALC283 Analog [ALC283 Analog]
  Subdevices: 1/1
...
card 1: II [irDAC II], device 0: USB Audio [USB Audio]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><p>From this output you see that soundcard <code>irDAC II</code> got an index value of <code>1</code>
and it controls only one audio device <code>0</code> named simply <code>USB Audio</code>.</p> <p>Let's make the soundcard index <code>1</code> permanent for <code>irDAC II</code>.</p> <h4 id="find-the-vid-and-pid-of-your-dac"><a href="#find-the-vid-and-pid-of-your-dac" aria-hidden="true" class="header-anchor">#</a> Find the VID and PID of your DAC</h4> <p>To do this you need to find out the Vendor ID (VID) and the Product ID (PID) of
your USB DAC. These values identify a plugged USB device. List all the attached
USB devices and try to find your DAC. For example:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>lsusb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="output"><p class="title">Output:</p><div class="language- line-numbers-mode"><pre class="language-text"><code>Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 003: ID 8087:0aa7 Intel Corp.
Bus 001 Device 073: ID 25c4:0008
Bus 001 Device 058: ID 1058:25a2 Western Digital Technologies, Inc.
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><p>Most likely, you will not see the vendor name of your device in the list. To
understand which device is your DAC, try to disconnect the DAC, list the USB
devices, reconnect the DAC and print the list again to see what IDs appeared in
the list. You can also increase the verbosity of <code>lsusb</code> output with the
<code>--verbose</code> option:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>lsusb --verbose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>In the verbose output try to search for terms <code>Audio</code> and/or <code>Control Device</code>.</p> <p>With the help of the disconnect-list-connect-list-again method I found out that
my DAC is denoted as <code>Bus 001 Device 073: ID 25c4:0008</code> line in the <code>lsusb</code>
output. Here <code>25c4</code> is the Vendor ID and <code>0008</code> is the Product ID.</p> <h4 id="set-a-permanent-index-for-your-dac"><a href="#set-a-permanent-index-for-your-dac" aria-hidden="true" class="header-anchor">#</a> Set a permanent index for your DAC</h4> <p>Let's edit the <code>/etc/modprobe.d/alsa-base.conf</code> and set options for the
<code>snd-usb-audio</code> module. First, open the file in a text editor:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo vim /etc/modprobe.d/alsa-base.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>According to the <a href="https://alsa-project.org/wiki/Matrix:Module-usb-audio" target="_blank" rel="noopener noreferrer">ALSA Project
documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, the
values of module options for <code>snd-usb-audio</code>, such as <code>index</code>, <code>vid</code> and <code>pid</code>,
should be arrays of integers. Below is an example of how to set the options,
just add that single line to the file:</p> <div class="output"><p class="title">/etc/modprobe.d/alsa-base.conf:</p><div class="language- line-numbers-mode"><pre class="language-text"><code>options snd-usb-audio index=1 vid=0x25c4 pid=0x0008
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div><p>Note that VID and PID are hexadecimal numbers, so you need to prefix them with
<code>0x</code>.</p> <p>If you want to assign another permanent index value to another sound device of
yours, add its index number, VID and PID to the corresponding arrays. Use
commas to separate the values in the arrays.</p> <p>In the following example I assign index <code>2</code> to my second DAC — a Dragonfly
Black — which has a VID <code>21b4</code> and PID <code>0083</code>:</p> <div class="output"><p class="title">/etc/modprobe.d/alsa-base.conf:</p><div class="language- line-numbers-mode"><pre class="language-text"><code>options snd-usb-audio index=1,2 vid=0x25c4,0x21b4 pid=0x0008,0x0083
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div><p>When you set the proper values, write the file (use <code>:wq</code> in Vim) and reload
the <code>snd-usb-audio</code> kernel module:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo modprobe -r snd-usb-audio
sudo modprobe snd-usb-audio
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>That's it! You can now check your USB devices list while
disconnecting/connecting your audio devices in random order and see that each
device gets the same index number every time you connect it.</p> <h3 id="mpd-configuration"><a href="#mpd-configuration" aria-hidden="true" class="header-anchor">#</a> MPD Configuration</h3> <p>First, you need to install MPD on your computer.</p> <p>You can either build MPD from source code or install it from the official
repositories of your Linux distribusion.</p> <p>To install MPD on Ubuntu, run:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo apt-get update
sudo apt-get install mpd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Check the status of the <code>mpd</code> service. If your Linux distro has the <code>systemd</code>
service manager (Ubuntu switched to <code>systemd</code> in version 15.04), run the
following command:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo systemctl status mpd.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="output"><p class="title">If MPD is running, you will see a similar output:</p><div class="language- line-numbers-mode"><pre class="language-text"><code>● mpd.service - Music Player Daemon
   Loaded: loaded (/lib/systemd/system/mpd.service; enabled; vendor preset: enabled)
   Active: active (running) since Fri 2019-10-04 00:45:52 MSK; 14s ago
     Docs: man:mpd(1)
           man:mpd.conf(5)
           file:///usr/share/doc/mpd/user-manual.html
 Main PID: 11181 (mpd)
    Tasks: 3 (limit: 4915)
   Memory: 12.6M
      CPU: 511ms
   CGroup: /system.slice/mpd.service
           └─11181 /usr/bin/mpd --no-daemon

Oct 04 00:45:52 nuc systemd[1]: Starting Music Player Daemon...
Oct 04 00:45:52 nuc mpd[11181]: hybrid_dsd: The Hybrid DSD decoder is disabled because it was not explicitly enabled
Oct 04 00:45:52 nuc systemd[1]: Started Music Player Daemon.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></div><p>Now you need to configure your MPD server. Refer to the official <a href="https://www.musicpd.org/doc/html/user.html#configuration" target="_blank" rel="noopener noreferrer">MPD
documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to
learn about the supported settings and their values.</p> <p>MPD reads its configuration from a text file. Usually, that is <code>/etc/mpd.conf</code>,
unless a different path is specified on the command line. To edit the
configuration file, run:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo vim /etc/mpd.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The following example shows my personal MPD configuration:</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>music_directory &quot;/media/Media/Music&quot;

database {
  plugin &quot;simple&quot;
  path &quot;/var/lib/mpd/db&quot;
}

state_file   &quot;/var/lib/mpd/state&quot;
sticker_file &quot;/var/lib/mpd/stickers&quot;
playlist_directory &quot;/var/lib/mpd/playlists&quot;

log_file &quot;syslog&quot;
#log_level &quot;verbose&quot;

user &quot;mpd&quot;
zeroconf_name &quot;Intel NUC — MPD&quot;
auto_update &quot;no&quot;

resampler {
  plugin &quot;libsamplerate&quot;
  type &quot;0&quot;
}
replaygain &quot;off&quot;

input {
  plugin &quot;tidal&quot;
  enabled &quot;no&quot;
}

input {
  plugin &quot;qobuz&quot;
  enabled &quot;no&quot;
}

audio_output {
  type &quot;alsa&quot;
  name &quot;Arcam irDAC-II&quot;
  device &quot;hw:1,0&quot;

  auto_resample &quot;no&quot;
  auto_channels &quot;no&quot;
  auto_format &quot;no&quot;
  dop &quot;yes&quot;

  mixer_type &quot;none&quot;
  replay_gain_handler &quot;none&quot;
}

audio_output {
  type &quot;alsa&quot;
  name &quot;AudioQuest DragonFly Black v1.5&quot;
  device &quot;hw:2,0&quot;

  auto_resample &quot;no&quot;
  auto_channels &quot;no&quot;
  auto_format &quot;no&quot;

  mixer_type &quot;hardware&quot;
  mixer_device &quot;hw:2&quot;
  mixer_control &quot;PCM&quot;
  mixer_index &quot;0&quot;
  replay_gain_handler &quot;mixer&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>Now let us analyse it line by line. Here I will quote the official
documentation quite a lot.</p> <h4 id="music-directory"><a href="#music-directory" aria-hidden="true" class="header-anchor">#</a> Music directory</h4> <p>When you play local files, you should organize them within a directory called
the “music directory”. This is configured in MPD with the
<a href="https://www.musicpd.org/doc/html/user.html#configuring-the-music-directory" target="_blank" rel="noopener noreferrer"><code>music_directory</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
setting:</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>music_directory &quot;/media/Media/Music&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Here <code>/media/Media</code> is where my external HDD drive is mounted into the root
filesystem. Ubuntu usually mounts external drives to <code>/media</code>. <code>Music</code> is the
folder where I keep most of my music on the drive.</p> <h4 id="database"><a href="#database" aria-hidden="true" class="header-anchor">#</a> Database</h4> <p>If a music directory is configured, one database plugin is used. To configure
this plugin, add a
<a href="https://www.musicpd.org/doc/html/user.html#configuring-database-plugins" target="_blank" rel="noopener noreferrer">database<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> block to mpd.conf:</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>database {
  plugin &quot;simple&quot;
  path &quot;/var/lib/mpd/db&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>simple</code> is the default plugin. It stores a copy of the database in memory. A
file is used for permanent storage.</p> <h4 id="the-state-file"><a href="#the-state-file" aria-hidden="true" class="header-anchor">#</a> The state file</h4> <p>The <a href="https://www.musicpd.org/doc/html/user.html#the-state-file" target="_blank" rel="noopener noreferrer">state file<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is
a file where MPD saves and restores its state (play queue, playback position
etc.) to keep it persistent across restarts and reboots. It is an optional
setting.</p> <p>MPD will attempt to load the state file during startup, and will save it
when shutting down the daemon. Additionally, the state file is refreshed
every two minutes (after each state change).</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>state_file   &quot;/var/lib/mpd/state&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="the-sticker-database"><a href="#the-sticker-database" aria-hidden="true" class="header-anchor">#</a> The sticker database</h4> <p><a href="https://www.musicpd.org/doc/html/user.html#the-sticker-database" target="_blank" rel="noopener noreferrer">“Stickers”<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
are pieces of information attached to songs. Some clients use them to store
ratings and other volatile data.</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>sticker_file &quot;/var/lib/mpd/stickers&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="playlist-directory"><a href="#playlist-directory" aria-hidden="true" class="header-anchor">#</a> Playlist directory</h4> <p>Stored playlists are some kind of secondary playlists which can be created,
saved, edited and deleted by the client. They are addressed by their names. Its
contents can be loaded into the queue, to be played back. The
<a href="https://www.musicpd.org/doc/html/user.html#stored-playlists" target="_blank" rel="noopener noreferrer">playlist_directory<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
setting specifies where those playlists are stored:</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>playlist_directory &quot;/var/lib/mpd/playlists&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="log-file"><a href="#log-file" aria-hidden="true" class="header-anchor">#</a> Log file</h4> <p>The <code>log_file</code> parameter specifies where the log file should be located. The
special value <code>syslog</code> makes MPD use the local syslog daemon:</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>log_file &quot;syslog&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p>If you set the <code>log_file</code> to <code>syslog</code> and your Linux distro runs <code>systemd</code>
service manager (Ubuntu switched to <code>systemd</code> in version 15.04), you can use
<code>journalctl</code> to view logs in real time:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo journalctl -u mpd.service -f
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <h4 id="log-level"><a href="#log-level" aria-hidden="true" class="header-anchor">#</a> Log level</h4> <p>The <code>log_level</code> parameter specifies how verbose the logs are. Set <code>log_level</code>
to <code>verbose</code> to make MPD record excessive amounts of information for debugging
purposes, in case you need to find out why your MPD is not working.</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>#log_level &quot;verbose&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>In my configuration I commented out the <code>log_level</code> parameter completely with
the <code>#</code> symbol.</p> <div class="tip custom-block"><p>When MPD loads its configuration, it ignores lines that start with the <code>#</code>
symbol. If an optional parameter is not set in the configuration or you
commented it out, MPD will use a default value for it.</p> <p>The default value for <code>log_level</code> is… <code>default</code>, which means minimal logging.</p></div> <p>When I was doing my initial setup of MPD, I set <code>log_level</code> to <code>verbose</code> to
understand how different configuration parameters change the way MPD works.
When I was done with the configuration, I commented <code>log_level</code> out and
restarted MPD to return it back to the default minimal logging.</p> <h4 id="mpd-process-user"><a href="#mpd-process-user" aria-hidden="true" class="header-anchor">#</a> MPD process user</h4> <p>The <code>user</code> parameter specifies the user that MPD will run as, if set. MPD
should never run as root, and you may use this option to make MPD change its
user id after initialization.</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>user &quot;mpd&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>To create a system user for MPD, run:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo useradd -G audio -r mpd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This will create a system user <code>mpd</code> and add it to group <code>audio</code>, which allows
direct access to sound hardware.</p> <h4 id="zeroconf-name"><a href="#zeroconf-name" aria-hidden="true" class="header-anchor">#</a> Zeroconf name</h4> <p>Via Zeroconf, MPD can announce its presence on the network. Zeroconf in MPD is
enabled by default. You can specify the service name to publish via Zeroconf
with the <code>zeroconf_name</code> setting. This is the name that MPD clients display
when you connect to your MPD server.</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>zeroconf_name &quot;Intel NUC — MPD&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Now restart MPD:</p> <h4 id="auto-update"><a href="#auto-update" aria-hidden="true" class="header-anchor">#</a> Auto update</h4> <p>MPD supports automatic update of music database when files are changed in
the <code>music_directory</code>. You can freely enable automatic update unless you mount
network filesystems, such as NFS, inside your music directory. The thing is
that for automatic updates MPD relies on the Linux kernel subsystem <code>inotify</code>
which provides a mechanism for monitoring filesystem events. Unfortunately,
<code>inotify</code> cannot track changes on remote filesystems.</p> <p>I store a part of my music library on a remote server and mount it via NFS. I
had issues with automatic update because of that and had to disable this
feature.</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>auto_update &quot;no&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="resampler"><a href="#resampler" aria-hidden="true" class="header-anchor">#</a> Resampler</h4> <p>Sometimes, music needs to be resampled before it can be played; for example,
when you want to play high-res audio with 192 kHz sampling rate, while your DAC
can only handle 96 kHz. Resampling reduces the quality and consumes a lot of
CPU. There are different options, some of them optimized for high quality and
others for low CPU usage, but you can’t have both at the same time. Often, the
resampler is the component that is responsible for most of MPD’s CPU usage.
Since MPD comes with high quality defaults, it may appear that MPD consumes
more CPU than other software.</p> <p>Check the <a href="https://www.musicpd.org/doc/html/plugins.html#resampler-plugins" target="_blank" rel="noopener noreferrer">Resampler
plugins<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
reference for a list of resamplers and how to configure them. Out of all the
resampler plugins, <code>libsamplerate</code>, also known as Secret Rabbit Code (SRC),
with the &quot;Best Sinc&quot; interpolator (interpolator type <code>0</code>) provides the best
quality.</p> <p>The resampler can be configured in a block named <code>resampler</code>:</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>resampler {
  plugin &quot;libsamplerate&quot;
  type &quot;0&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="replaygain"><a href="#replaygain" aria-hidden="true" class="header-anchor">#</a> ReplayGain</h4> <p>If <code>replaygain</code> is specified, MPD will adjust the volume of songs played
using ReplayGain tags. We do not want our audio signal to change until it
reaches the analog stage, so we disable ReplayGain completely:</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>replaygain &quot;off&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="input-plugins"><a href="#input-plugins" aria-hidden="true" class="header-anchor">#</a> Input plugins</h4> <p>By default, MPD runs with Tidal and Qobuz plugins enabled. If you don't use
these services, just disable the plugins:</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>input {
  plugin &quot;tidal&quot;
  enabled &quot;no&quot;
}

input {
  plugin &quot;qobuz&quot;
  enabled &quot;no&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="audio-outputs"><a href="#audio-outputs" aria-hidden="true" class="header-anchor">#</a> Audio outputs</h4> <p>Now it's time to configure audio outputs!</p> <p>Each audio output is configured in a separate <code>audio_output</code> block. You can
configure multiple outputs and turn them on/off via your MPD client
application.</p> <p>Each output's functionality is provided by an output plugin. You can find more information in the <a href="https://www.musicpd.org/doc/html/plugins.html#output-plugins" target="_blank" rel="noopener noreferrer">Output plugins<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> reference.</p> <div class="tip custom-block"><p>There are several rules you need to follow to achieve bit-perfect playback with
MPD:</p> <ul><li>Use the ALSA output plugin.</li> <li>Disable sound processing inside ALSA by configuring a “hardware” device
(<code>hw:0,0</code> or similar).</li> <li>Don't use software volume control (setting <code>mixer_type</code>).</li> <li>If you control volume on a pre-amp, set the souncard's (i. e. “hardware”)
mixer volume to 0 dB full scale. For that run <code>alsamixer</code>, press F6, choose
your soundcard, select the mixer and adjust the volume.</li> <li>Don't force MPD to use a specific audio format (settings <code>format</code>,
<code>audio_output_format</code>).</li></ul></div> <p>Below is the audio output configuration that I use for my Arcam irDAC-II:</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>audio_output {
  type &quot;alsa&quot;
  name &quot;Arcam irDAC-II&quot;
  device &quot;hw:1,0&quot;

  auto_resample &quot;no&quot;
  auto_channels &quot;no&quot;
  auto_format &quot;no&quot;
  dop &quot;yes&quot;

  mixer_type &quot;none&quot;
  replay_gain_handler &quot;none&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Let's analyse it line by line.</p> <ul><li><p>(2) <code>type</code> is the name of the audio output plugin.</p></li> <li><p>(3) <code>name</code> sets the name of the audio output. You will see it in an MPD
client.</p></li> <li><p>(4) <code>device</code> sets the device name.</p> <p>This can be any valid ALSA device name, but we need to tell ALSA to access
the hardware device directly, by specifying PCM type <code>hw</code> followed by the
sound card number and the device number. A third number can be added
(<code>hw:0,0,0</code>) for the sub-device number, but it defaults to the next
sub-device available. The numbers start from zero, so, for example, to
access the first device on the second sound card, you would use <code>hw:1,0</code>.</p> <p>Refer to the <a href="/audio/#permanent-index-value-for-the-sound-card-recommended">Permanent index value for the sound
card</a> section on
how to find and permanently set the sound card index number. Usually, sound
cards in DACs control only one device, so the device number would be <code>0</code>.</p> <p>For my Arcam irDAC's sound card, I permanently set the index value to <code>1</code>,
so I address to it as <code>hw:1,0</code>.</p></li> <li><p>(6, 7, 8) The <code>auto_resample</code>, <code>auto_channels</code> and <code>auto_format</code> settings are
disabled, so ALSA will not attempt to resample, convert between different
channel numbers and sample formats (16 bit, 24 bit, etc.)</p></li> <li><p>(9) If <code>dop</code> is set to yes, then DSD over PCM according to the <a href="http://dsd-guide.com/dop-open-standard" target="_blank" rel="noopener noreferrer">DoP
standard<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is enabled. This wraps DSD
samples in fake 24 bit PCM, and is understood by some DSD capable products,
but may be harmful to other hardware. The default value is <code>no</code> and you can
enable the option at your own risk.</p> <p>Although Arcam lists DSD128 in the audio formats supported by irDAC, irDAC
does not support native DSD and plays DSD128 only via DoP. That is why I
enabled it.</p></li> <li><p>(11) <code>mixer_type</code> specifies which mixer should be used for the audio
output: hardware, software, null or none.</p> <p>The rule of thumb here is not to
use sound card mixers, if possible, and adjust the volume on a pre-amp. This
is what I do with the irDAC.</p> <p>However, sometimes you might want to use the mixer on your device. See the
next audio output configuration for an example on that.</p></li> <li><p>(12) <code>replay_gain_handler</code> specifies how replay gain is applied. The default
is <code>software</code>, which uses an internal software volume control. <code>mixer</code> uses
the configured (hardware) mixer control. <code>none</code> disables replay gain on this
audio output.</p> <p>As I do not use neither software, nor hardware mixers, I explicitly disable
replay gain on this audio output.</p></li></ul> <hr> <p>The next configuration example is the audio output configuration I use for my
second DAC — AudioQuest DragonFly Black v1.5:</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>audio_output {
  type &quot;alsa&quot;
  name &quot;AudioQuest DragonFly Black v1.5&quot;
  device &quot;hw:2,0&quot;

  auto_resample &quot;no&quot;
  auto_channels &quot;no&quot;
  auto_format &quot;no&quot;

  mixer_type &quot;hardware&quot;
  mixer_device &quot;hw:2&quot;
  mixer_control &quot;PCM&quot;
  mixer_index &quot;0&quot;
  replay_gain_handler &quot;mixer&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>As you can see, it’s almost the same as the previous configuration. What’s
different here is the <code>device</code> name , <code>mixer_type</code> and <code>replay_gain_handler</code>:</p> <ul><li><p>(4) The <code>device</code> is set to <code>hw:2,0</code>, as the DragonFly’s soundcard is using
index number <code>2</code>.</p></li> <li><p>(10) As I cannot control the volume on the DragonFly’s pre-amp physically,
I need to use its mixer. That’s why <code>mixer_type</code> is set to <code>hardware</code>.</p></li> <li><p>(11) <code>mixer_device</code> should address the soundcard (without the subdevice
index).</p></li> <li><p>(12) <code>mixer_control</code> specifies a mixer control, defaulting to <code>PCM</code>. Run
<code>amixer --card N scontrols</code> to get a list of available mixer controls on the
soundcard.</p></li> <li><p>(13) <code>mixer_index</code> specifies a mixer control index. This is necessary if
there is more than one control with the same name. Defaults to 0 (the first
one).</p></li> <li><p>(14) <code>replay_gain_handler</code> is set to <code>mixer</code>. If I enable
<a href="/audio/#replaygain">ReplayGain</a>, MPD will adjust the volume using the hardware
mixer specified above.</p></li></ul> <hr> <p>When you are done with configuration, save the changes in the file (in Vim,
type <code>:wq</code>) and restart MPD:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo systemctl restart mpd.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Now connect to it with your client and put some music on playback!</p> <div class="warning custom-block"><p>This guide is being updated. Stay tuned!‥</p></div> <br> <!----> <br> <div style="text-align:center;font-size:x-small;">
    Allow loading scripts from disqus.com to see the comments.
</div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">21/10/2019, 23:58:24</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/audio/edit-encoded-audio-with-ffmpeg-and-audacity.html">
          Edit Encoded Audio with FFmpeg and Audacity
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5a925217.js" defer></script><script src="/assets/js/2.e9e99a32.js" defer></script><script src="/assets/js/5.9c8db5fa.js" defer></script>
  </body>
</html>
